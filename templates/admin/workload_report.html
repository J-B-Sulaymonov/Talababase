{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<style>

    /* Filter qismi */
    .filter-section {
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        gap: 15px;
        align-items: flex-end;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .filter-section label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 11px;
        color: #333;
    }
    .filter-section select {
        padding: 5px;
        border: 1px solid #ccc;
        min-width: 150px;
        border-radius: 3px;
    }
    .btn-submit {
        background-color: #447e9b;
        color: white;
        border: none;
        padding: 6px 15px;
        cursor: pointer;
        font-weight: bold;
        border-radius: 3px;
    }
    .btn-submit:hover { background-color: #35637a; }

    /* Jadval dizayni */
    .report-table {
        width: 100%;
        border-collapse: collapse;
        color: #000;
        margin-bottom: 30px;
        font-size: 11px;
    }
    .report-table th, .report-table td {
        border: 1px solid #000;
        padding: 4px 2px;
        text-align: center;
        vertical-align: middle;
        line-height: 1.2;
    }

    .report-table thead th {
        font-weight: bold;
    }

    /* Ranglar */
    .th-kuzgi { background-color: #d99694; }
    .th-bahorgi { background-color: #dce6f1; }
    .bg-yellow { background-color: #ffff00; font-weight: bold; }
    .bg-pink { background-color: #e6b8b7; font-weight: bold; }
    .bg-purple-gray { background-color: #ccc1d9; font-weight: bold; }
    .bg-blue-light { background-color: #b8cce4; }

    /* Vertikal matn */
    .vertical-text {
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        white-space: nowrap;
        padding: 10px 2px;
        height: 100px;
    }

    .col-subject { text-align: left; padding-left: 5px; font-weight: bold; min-width: 180px; }
    .col-teacher { text-align: left; padding-left: 5px; min-width: 150px; font-weight: bold; }

    .row-numbers td {
        background-color: #f2f2f2;
        color: #555;
        font-size: 9px;
    }

    .print-btn {
        float: right;
        background: #28a745;
        color: white;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        font-size: 14px;
        border-radius: 4px;
        margin-bottom: 10px;
    }

    @media print {
        .print-btn, .excel-btn, .filter-section, .breadcrumbs, #header, .nav-sidebar {
            display: none !important;
        }
        .content { margin: 0; padding: 0; width: 100%; }
        .report-table { font-size: 9px; width: 100%; }
        @page {
            size: landscape;
            margin: 5mm;
        }
        .bg-yellow { background-color: #ffff00 !important; -webkit-print-color-adjust: exact; }
        .bg-pink { background-color: #e6b8b7 !important; -webkit-print-color-adjust: exact; }
        .bg-purple-gray { background-color: #ccc1d9 !important; -webkit-print-color-adjust: exact; }
        .th-kuzgi { background-color: #d99694 !important; -webkit-print-color-adjust: exact; }
        .th-bahorgi { background-color: #dce6f1 !important; -webkit-print-color-adjust: exact; }
        .bg-blue-light { background-color: #b8cce4 !important; -webkit-print-color-adjust: exact; }
    }
</style>

<div style="padding: 10px;">

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 style="margin: 0; padding: 10px 0; font-size: 20px;">{{ title }}</h1>
        <div>
            <a href="{% url 'admin:workload_export_excel' %}?{{ request.GET.urlencode }}" class="excel-btn" style="background: #217346; color: white; padding: 8px 15px; border-radius: 4px; text-decoration: none; margin-right: 5px; font-size: 14px;">
                üìä Excelga yuklash
            </a>
            <button onclick="window.print()" class="print-btn" style="float: none; margin-bottom: 0;">üñ®Ô∏è Chop etish</button>
        </div>
    </div>

    <form method="get" class="filter-section">
        <div>
            {{ filter_form.academic_year.label_tag }}
            {{ filter_form.academic_year }}
        </div>
        <div>
            {{ filter_form.education_form.label_tag }}
            {{ filter_form.education_form }}
        </div>
        <div>
            {{ filter_form.course.label_tag }}
            {{ filter_form.course }}
        </div>
        <button type="submit" class="btn-submit">Ko'rish</button>
    </form>

    <table class="report-table">
        <thead>
            <tr>
                <th rowspan="3" style="width: 30px;">‚Ññ</th>
                <th rowspan="3">Fanlar nomi</th>
                <th rowspan="3">Ta'lim yo'nalishlari</th>
                <th rowspan="3">Guruh raqami</th>
                <th rowspan="3" class="vertical-text">Kurs</th>
                <th rowspan="3" class="vertical-text">Talabalar<br>soni</th>
                <th rowspan="3" class="vertical-text">Guruhlar<br>soni</th>

                <th colspan="9" class="th-kuzgi">KUZGI SEMESTR</th>

                <th colspan="9" class="th-bahorgi">BAHORGI SEMESTR</th>

                <th rowspan="3" class="bg-purple-gray" style="width: 50px;">JAMI<br>YILLIK<br>YUKLAMA</th>
                <th rowspan="3">Professor - o'qituvchi F.I.Sh</th>
            </tr>

            <tr>
                <th colspan="2">Ma'ruza</th>
                <th colspan="2">Amaliy mashg'ulot</th>
                <th colspan="2">Laboratoriya</th> <th colspan="2">Seminar mashg'uloti</th>
                <th rowspan="2" class="bg-pink">Jami</th>

                <th colspan="2">Ma'ruza</th>
                <th colspan="2">Amaliy mashg'ulot</th>
                <th colspan="2">Laboratoriya</th> <th colspan="2">Seminar mashg'uloti</th>
                <th rowspan="2" class="bg-blue-light">Jami</th>
            </tr>

            <tr>
                <th>reja</th> <th class="bg-yellow">jami</th>
                <th>reja</th> <th class="bg-yellow">jami</th>
                <th>reja</th> <th class="bg-yellow">jami</th> <th>reja</th> <th class="bg-yellow">jami</th>

                <th>reja</th> <th class="bg-yellow">jami</th>
                <th>reja</th> <th class="bg-yellow">jami</th>
                <th>reja</th> <th class="bg-yellow">jami</th> <th>reja</th> <th class="bg-yellow">jami</th>
            </tr>

            <tr class="row-numbers">
                <td>1</td> <td>2</td> <td>3</td> <td>4</td> <td>5</td> <td>6</td> <td>7</td>

                <td>8</td> <td>9</td>    <td>10</td> <td>11</td>  <td>12</td> <td>13</td>  <td>14</td> <td>15</td>  <td>16</td>              <td>17</td> <td>18</td>  <td>19</td> <td>20</td>  <td>21</td> <td>22</td>  <td>23</td> <td>24</td>  <td>25</td>              <td>26</td> <td>27</td>
            </tr>
        </thead>
        <tbody>
            {% for row in report_data %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td class="col-subject">{{ row.subject }}</td>
                <td style="font-size: 10px;">{{ row.specialties }}</td>
                <td style="font-size: 10px;">{{ row.groups }}</td>
                <td>{{ row.course }}</td>
                <td>{{ row.students }}</td>
                <td>{{ row.group_count }}</td>

                <td>{{ row.kuzgi.lec_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.kuzgi.lec_j|default_if_none:"" }}</td>

                <td>{{ row.kuzgi.prac_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.kuzgi.prac_j|default_if_none:"" }}</td>

                <td>{{ row.kuzgi.lab_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.kuzgi.lab_j|default_if_none:"" }}</td>

                <td>{{ row.kuzgi.sem_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.kuzgi.sem_j|default_if_none:"" }}</td>

                <td class="bg-pink">{{ row.kuzgi.total }}</td>


                <td>{{ row.bahorgi.lec_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.bahorgi.lec_j|default_if_none:"" }}</td>

                <td>{{ row.bahorgi.prac_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.bahorgi.prac_j|default_if_none:"" }}</td>

                 <td>{{ row.bahorgi.lab_r|default_if_none:"" }}</td>
                 <td class="bg-yellow">{{ row.bahorgi.lab_j|default_if_none:"" }}</td>

                <td>{{ row.bahorgi.sem_r|default_if_none:"" }}</td>
                <td class="bg-yellow">{{ row.bahorgi.sem_j|default_if_none:"" }}</td>

                <td class="bg-blue-light">{{ row.bahorgi.total }}</td>

                <td class="bg-purple-gray">{{ row.year_total }}</td>

                <td class="col-teacher">{{ row.teacher }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="27" style="padding: 20px; color: #777; font-style: italic;">
                    Tanlangan filtr bo'yicha ma'lumotlar topilmadi.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}