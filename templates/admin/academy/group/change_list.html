{% extends "admin/change_list.html" %}
{% load i18n static humanize %}

{% block extrahead %}
{{ block.super }}

{# --- STATISTIKA BLOKI --- #}
<div id="stats-data-source" style="display: none;">
    <div class="stats-dashboard-widget">
        <div class="stat-box groups-stat">
            <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
            <div class="stat-info">
                <span class="stat-label">Faol guruhlar</span>
                <span class="stat-value">{{ footer_stats.active_groups|default:"0" }}</span>
            </div>
        </div>
        <div class="stat-box students-stat">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-info">
                <span class="stat-label">Jami o'quvchilar</span>
                <span class="stat-value">{{ footer_stats.total_students|default:"0" }}</span>
            </div>
        </div>
        {% if user.is_superuser or user.username == 'Iskandar' or user.username == 'direktor' %}
        <div class="stat-box revenue-stat">
            <div class="stat-icon"><i class="fas fa-coins"></i></div>
            <div class="stat-info">
                <span class="stat-label">Oylik daromad</span>
                <span class="stat-value">{{ footer_stats.monthly_revenue|floatformat:0|intcomma|default:"0" }}</span>
            </div>
        </div>
        <div class="stat-box teacher-stat">
            <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
            <div class="stat-info">
                <span class="stat-label">O'qituvchi xarajat</span>
                <span class="stat-value">{{ footer_stats.teacher_expense|floatformat:0|intcomma|default:"0" }}</span>
            </div>
        </div>
        <div class="stat-box profit-stat">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-info">
                <span class="stat-label">Sof foyda (oylik)</span>
                <span class="stat-value">{{ footer_stats.net_profit|floatformat:0|intcomma|default:"0" }}</span>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    /* JADVAL DIZAYNLARI */
    #result_list {
        border-collapse: separate !important;
        border-spacing: 0 8px !important;
        width: 100%;
        border: none !important;
        margin-top: 10px;
    }

    /* HEADER */
    #result_list thead th {
        background-color: #2c3e50;
        color: #ffffff !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 13px;
        padding: 16px 12px;
        border: none;
        vertical-align: middle;
        position: relative;
        white-space: nowrap;
    }

    #result_list thead th a {
        color: #ffffff !important;
        text-decoration: none;
    }

    #result_list thead th a:hover {
        color: #dbe4ff !important;
        text-decoration: underline;
    }

    #result_list tbody tr {
        background-color: #ffffff;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.04);
        transition: all 0.2s;
        border-radius: 8px;
    }

    #result_list tbody tr:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        z-index: 100;
        position: relative;
    }

    #result_list tbody td,
    #result_list tbody th {
        padding: 12px 14px;
        vertical-align: middle;
        border: none;
        font-size: 15px;
        color: #2d3436;
        font-weight: 500;
        height: 60px;
    }

    #result_list tbody tr td:first-child,
    #result_list tbody tr th:first-child {
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
    }

    #result_list tbody tr td:last-child {
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
    }

    /* Money columns */
    #result_list .field-formatted_price,
    #result_list .field-formatted_teacher_price,
    #result_list .field-get_monthly_revenue {
        white-space: nowrap !important;
        min-width: 120px;
    }

    /* Badges */
    .group-badge {
        background: #f1f3f5;
        color: #495057;
        font-weight: 600;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 13px;
        border: 1px solid #dee2e6;
        white-space: nowrap;
        display: inline-block;
        margin: 2px;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 6px 12px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 700;
        min-width: 60px;
        white-space: nowrap;
    }

    .badge-success {
        background-color: #e6fcf5;
        color: #0ca678;
        border: 1px solid #c3fae8;
    }

    .badge-danger {
        background-color: #fff5f5;
        color: #fa5252;
        border: 1px solid #ffc9c9;
    }

    .badge-info {
        background-color: #e7f5ff;
        color: #1c7ed6;
        border: 1px solid #a5d8ff;
    }

    /* Statistika */
    .stats-dashboard-widget {
        display: flex;
        gap: 20px;
        padding: 20px 0;
        margin-bottom: 5px;
        flex-wrap: wrap;
    }

    .stat-box {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(0, 0, 0, 0.02);
        min-width: 180px;
        flex: 1;
        transition: transform 0.2s;
        cursor: default;
    }

    .stat-box:hover {
        transform: translateY(-3px);
    }

    .stat-box.groups-stat .stat-icon {
        color: #fff;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-box.students-stat .stat-icon {
        color: #fff;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .stat-box.revenue-stat .stat-icon {
        color: #fff;
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .stat-box.teacher-stat .stat-icon {
        color: #fff;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .stat-box.profit-stat .stat-icon {
        color: #fff;
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .stat-icon {
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        font-size: 20px;
        margin-right: 15px;
        flex-shrink: 0;
    }

    .stat-info {
        display: flex;
        flex-direction: column;
    }

    .stat-label {
        font-size: 11px;
        text-transform: uppercase;
        color: #adb5bd;
        font-weight: 700;
    }

    .stat-value {
        font-size: 20px;
        font-weight: 800;
        color: #212529;
        white-space: nowrap;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        // --- 1. STATISTIKA PANELINI JOYLASH ---
        const statsHTML = document.getElementById('stats-data-source').innerHTML;
        const statsDiv = document.createElement('div');
        statsDiv.innerHTML = statsHTML;

        const searchBar = document.getElementById('changelist-search');
        const tableForm = document.getElementById('changelist-form');
        let targetForStats = document.getElementById('changelist-filter');

        if (searchBar) {
            targetForStats = targetForStats || searchBar;
            targetForStats.parentNode.insertBefore(statsDiv, targetForStats.nextSibling);
        } else if (tableForm) {
            tableForm.parentNode.insertBefore(statsDiv, tableForm);
        } else {
            const main = document.querySelector('.content-main');
            if (main) main.insertBefore(statsDiv, main.firstChild);
        }
    });
</script>
{% endblock %}